К числу компонентов второй очереди отнесены информационные системы, принимающие непосредственное участие в процессе сборки и доставки приложения (CI/CD). В качестве такой системы было выбрано ПО Jenkins, отвечающее требованиям по минимизации используемых ресурсов.
# Развертывание Jenkins
Развертывание Jenkins включает в себя установку сервера с его последующим конфигурированием, а также внесение дополнений в конфигурацию реверсивного прокси-сервера NGINX. 
## Развертывание сервера Jenkins
Установка сервера осуществляется в соответствии с [](Jenkins.md#Развертывание%20сервера%20Jenkins%20для%20работы%20с%20использованием%20обратного%20прокси-сервера|инструкцией). Команда копирования цепочки сертификатов УЦ в контейнер выполняются с поправкой на фактическое расположение соответствующего файла:
``` bash
docker cp /var/lib/docker/volumes/20240515-ca-data/_data/intermediate-ca/out/F8BE4182D21D4C68/ca.pem jenkins:/usr/local/share/ca-certificates/ca.crt
```
В целях снижения требований к ресурсам, на этом этапе нашего мероприятия не предполагается развертывание агента сборки: несмотря на то, что масштабирование производительности конвейера посредством наращивания числа агентов является общепринятой практикой, для достижения целей тестового стенда использование конфигурации, состоящей из одного сервера Jenkins является вполне оправданным
## Конфигурирование обратного прокси-сервера для работы с Jenkins
Для конфигурирования ранее развернутого NGINX в качестве обратного прокси-сервера для работы с Jenkins необходимо создать в каталоге `/etc/nginx/conf.d` файл с именем `jenkins.conf` с содержимым, представленным на [этой](Deployment/Jenkins/Nginx%20reverse%20proxy.md) странице, доработав его в соответствии с выбранным нами DNS-именем репозитория `jenkins.20240515.local`.
## Конфигурирование сервера Jenkins
Для первичного конфигурирования сервера Jenkins необходимо открыть его веб-интерфейс, доступный по URL [[https://jenkins.20240515.local/]]. Первичный пароль, необходимый для старта процедуры конфигурирования, можно получить из журналов событий Jenkins или использовать команду чтения файла `/var/jenkins_home/secrets/initialAdminPassword`, представленную в [инструкции](Jenkins.md). После ввода первичного пароля Jenkins перейдет в режим выбора устанавливаемых плагинов. Оптимальным вариантом является выбор в ручном режиме плагинов из следующего перечня:
- Folders
- Pipeline
- Pipeline: Stage View
- Git
Завершает процедуру развертывания создание учетной записи администратора и указание внешнего URL Jenkins, соответствующего тому, что сконфигурировано в NGINX:
![Pasted image 20240314171513](Pasted%20image%2020240314171513.png)
![Pasted image 20240314171607](Pasted%20image%2020240314171607.png)
## Проверка корректности настроек
Для проверки корректности выполненных настроек необходимо:
- создать задачу сборки с типом Freestyle;
- указать в ее настройках использование Git в качестве инструмента работы с репозиторием исходных кодов;
- выбрать URL, соответствующий одному из проектов в Gogs;
- сохранить задачу и запустить ее на исполнение;
- убедиться в том, что рабочий каталог содержит исходные коды, соответствующие заданному Gogs-репозиторию
# Сборка и развертывание плагина Jenkins для PT AI
Плагин Jenkins для PT AI является альтернативой штатному плагину AISA, основным отличием которого является возможность использования графического UI, интегрированного в веб-интерфейс Jenkins.
## Сборка плагина
Сборка плагина осуществляется в соответствии с инструкцией, представленной в [[https://github.com/POSIdev-community/ptai-ee-tools.git|GitHub-репозитории]], при этом целесообразно выбрать вариант, использующий Gradle в Docker:
![Pasted image 20240314174635](Pasted%20image%2020240314174635.png)
## Развертывание плагина
Развертывание плагина осуществляется штатными средствами администрирования Jenkins посредством интерфейса Dashboard / Manage Jenkins / Plugin Manager. Этот интерфейс позволяет осуществить загрузку установочного файла плагина `ptai-jenkins-plugin.hpi` и активировать его развертывание:
![Pasted image 20240314182335](Pasted%20image%2020240314182335.png)
![Pasted image 20240314182609](Pasted%20image%2020240314182609.png)
![Pasted image 20240314182616](Pasted%20image%2020240314182616.png)
Если до момента установки плагина в Jenkins отсутствовали его предыдущие версии, то плагин готов к использованию без перезагрузки.
## Конфигурирование плагина
Конфигурирование плагина Jenkins осуществляется посредством штатного UI веб-интерфейса Jenkins в разделе Dashboard / Manage Jenkins / Configure System. В секции PT AI vulnerability analysis необходимо создать конфигурацию, указав URL сервера PT AI и указать учетную запись, содержащую токен доступа, созданный посредством веб-интерфейса PT AI:
![Pasted image 20240314183154](Pasted%20image%2020240314183154.png)
## Конфигурирование задачи сборки
Наиболее простым в конфигурировании является задача класса Freestyle, управление настройками которой осуществляется посредством UI. Для того, чтобы включить анализ кода в состав задачи сборки, необходимо добавить соответствующий шаг:
![Pasted image 20240314183514](Pasted%20image%2020240314183514.png)
При сборке приложения соответствующий шаг сборки упакует исходные коды приложения, находящиеся в рабочем каталоге, отправит их на сервер PT AI, запустит задачу сканирования и по ее завершении выполнит действия, указанные в настройках, такие как оценку соответствия результатов сканирования политике безопасности, генерацию отчетов и т.д. Степень выполнения анализа кода можно отслеживать в выводе задачи сборки:
![Pasted image 20240314183822](Pasted%20image%2020240314183822.png)
