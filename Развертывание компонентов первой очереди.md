Состав компонентов первой очереди определен в соответствии с потребностью в повышении эффективности проведения демонстраций ПО линейки AppSec посредством подготовки программного кода и развертывания соответствующего ему приложения, позволяющих максимально раскрыть возможности продукта. В качестве такого ПО было выбрано веб-приложение OWASP Bricks, развернутое в Docker. Для хранения исходных кодов приложения используется репозиторий исходных кодов Gogs.
# Репозиторий исходных кодов на базе ПО Gogs
Функционирование продуктов линейки AppSec сложно представить себе в отрыве от процесса разработки, сборки и доставки приложения и одним из ключевых элементов этого процесса является репозиторий исходных кодов, хранящий всю историю разработки. В качестве такого репозитория мы используем ПО Gogs, представляющее собой легковесное приложение, разработанное на языке программирования Go.
## Развертывание Gogs
Развертывание Gogs осуществляется в соответствии с [инструкцией](Gogs).

Отметим, что в отличие от того, что мы видели ранее, команда запуска контейнера не содержит опции --publish, обеспечивающие привязку портов контейнера к портам хоста поскольку в нашем сценарии предполагается работа с Gogs исключительно посредством обратного прокси-сервера, который находится в одной и той же сети `ptdemo-bridge`.
> [!note] Примечание
> Протокол Git, реализованный в Gogs предполагает возможность доступа к исходным кодам как посредством HTTP(s), так и SSH. Эти протоколы поддерживаются в контейнере Gogs по портам 3000 и 22, соответственно. Поскольку NGINX используется в качестве обратного прокси-сервера, обеспечивающего работу с протоколами семейства HTTP, то в рамках нашего мероприятия мы сознательно идем на то, что доступ к исходным кодам будет доступен только посредством HTTPS
## Конфигурирование обратного прокси-сервера для работы с Gogs
Для конфигурирования ранее развернутого NGINX в качестве обратного прокси-сервера для работы с Gogs необходимо создать в каталоге `/etc/nginx/conf.d` файл с именем `gogs.conf` с содержимым, представленным на [этой](Deployment/Gogs/Nginx%20reverse%20proxy.md) странице, доработав его в соответствии с выбранным нами DNS-именем репозитория `gogs.20240515.local`.
Дополнительно отметим, что директива `proxy_pass` содержит значение, соответствующее имени контейнера Gogs, что обусловлено наличием в составе Docker внутреннего DNS-сервера, преобразующего имена контейнеров в IP-адреса внутренней сети Docker.
После сохранения `gogs.conf` перезапустим контейнер NGINX и убедимся в том, что сервер Gogs доступен по URL [[https://gogs.20240515.local]], при этом используется выпущенный ранее сертификат:
![[Pasted image 20240314115307.png]]
## Начальное конфигурирование Gogs
Сразу после развертывания, при попытке доступа к серверу Gogs в ответ пользователю выводится страница первоначального конфигурирования. На этой странице необходимо внести изменения в следующие настройки:
- Database Type: SQLite3 (возможностей этой файловой СУБД более, чем достаточно для использования Gogs в демонстрационных целях)
- Application URL: https://gogs.20240515.local/ (это значение соответствует сконфигурированному нами ранее внешнему DNS-имени, по которому сервер Gogs доступен за рамками сети Docker)
Кроме того, в разделе Admin Account Settings имеет смысл сразу явно указать аутентификационные данные администратора Gogs:
- Username: administrator
- Password / Confirm Password: P@ssw0rd
- Admin Email: admin@20240515.local
После завершения процедуры начального конфигурирования на экран будет выведено главное окно веб-интерфейса Gogs:
![[Pasted image 20240314120526.png]]
# Веб-приложение OWASP Bricks
В рамках демонстрации возможностей продуктов линейки AppSec целесообразно подготовить приложение, на результатах анализа которого можно максимально широко раскрыть потенциал решений Positive Technologies. При этом приложение должно быть выбрано с учетом возможности запуска его анализа как в статическом, так и в динамическом режиме. Кандидатом, пригодным на эту роль, может стать широко известное приложение OWASP Bricks.
## Создание репозитория исходных кодов OWASP Bricks в Gogs
Для создания репозитория OWASP Bricks в Gogs необходимо создать репозиторий в Gogs и загрузить в него исходные коды, хранящиеся в архиве, доступном по [[https://sourceforge.net/projects/owaspbricks/files/latest/download|ссылке]]. 
Для создания репозитория в Gogs необходимо нажать на соответствующую кнопку в веб-интерфейсе, указать имя `owasp-bricks` и нажать кнопку Create Repository:
![[Pasted image 20240314125201.png]]
После выполнения этого действия в Gogs будет создан пустой репозиторий Git:
![[Pasted image 20240314125413.png]]
Для того, чтобы загрузить в созданные репозиторий исходные коды Bricks, необходимо выполнить следующую последовательность команд:
``` bash
# Загрузка архива с исходными кодами из репозитория SourceForge
wget https://sourceforge.net/projects/owaspbricks/files/latest/download
# Распаковка загруженного архива
unzip ./download
cd bricks
# Инициализация локального репозитория, добавление файлов, сохранение начальной версии
git init
git add .
git commit -m "Initial commit"
# Добавление удаленного репозитория и загрузка кода в него
git remote add origin https://gogs.20240515.local/administrator/owasp-bricks.git
git push -u origin master
```
При выполнении команды `git push ...` потребуется ввести имя учетной записи administrator и соответствующий ей пароль, после чего исходные коды будут сохранены в репозиторий:
![[Pasted image 20240314134439.png]]
На этом этапе Gogs уже пригоден для использования в качестве источника исходных кодов при создании проекта в Application Inspector, однако, для большей наглядности имеет смысл развернуть приложение в контейнере.
## Разворачивание контейнера OWASP Bricks в Docker
Несмотря на то, что одним из базовых принципов упаковки приложений в Docker-образы является их максимальное разделение на составные части, такие как СУБД, объектные хранилища, REST-микросервисы, серверы очередей и т.д., для OWASP Bricks существует образ, который включает в себя как СУБД MySQL, так и веб-сервер с поддержкой PHP, в котором развернуто веб-приложение. Это позволяет развернуть контейнер с использованием команды, приведенной в [[OWASP Bricks.md|инструкции]] и добавить соответствующую запись в файл `/var/lib/bind/db.20240515.local`,  после чего приложение становится доступным по адресу [[http://bricks.20240515.local:8080/]]:
![[Pasted image 20240314145222.png]]
Необходимо отметить, что сразу после установки приложение еще не является пригодным к работе, т.к. при его развертывании не осуществляется создание и инициализация базы данных, это необходимо сделать вручную нажатием соответствующей кнопки в его интерфейсе:
![[Pasted image 20240314145545.png]]
Убедиться в работоспособности приложения можно, например, выполнив одну из задач, например, введя в поле Username значение `' OR 1=1; -- ` и произвольное непустое значение в поле Password на странице [[http://bricks.20240515.local:8080/login-1/]] и нажав кнопку Submit:
![[Pasted image 20240314145830.png]]
На этом этапе мы имеем возможность проведения анализа защищенности приложения как посредством статического (в т.ч. с использованием режима автопроверки уязвимостей), так и  динамического анализа:
![[Pasted image 20240314152847.png]]
![[Pasted image 20240314154333.png]]
Однако для того, чтобы продемонстрировать все возможности сканирования посредством BlackBox, необходимо осуществить развертывание веб-приложения, реализованного в виде микросервиса. В качестве такого микросервиса можно использовать VAmPI
# Микросервис VAmPI
Развертывание микросервиса осуществляется в соответствии с [[VAmPI.md|инструкцией]]. После разворачивания микросервиса становится возможной демонстрация возможностей по динамическому анализу REST API посредством BlackBox:
![[Pasted image 20240315150433.png]]